<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tr√§ningsstatistik</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:#0f172a;color:#e5e7eb}
    .wrap{max-width:1100px;margin:24px auto;padding:16px}
    a.btn{background:#22d3ee;color:#001018;padding:10px 14px;border-radius:12px;font-weight:600;text-decoration:none}
    .card{background:rgba(255,255,255,.05);border-radius:16px;padding:16px;margin-bottom:20px}
    h1{margin:0 0 12px}
    label{display:block;margin-bottom:6px}
    select{background:#0b1224;color:#e5e7eb;padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,.15)}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px 10px;text-align:left}
    tbody tr:nth-child(even){background:rgba(255,255,255,.05)}
    canvas{max-width:100%;height:400px}
  </style>
</head>
<body>
<div class="wrap">
  <a href="index.html" class="btn">‚Üê Tillbaka</a>
  <div class="card">
    <h1>üìä Statistik</h1>
    <label>V√§lj √∂vning:
      <select id="exerciseSelect"></select>
    </label>
    <label>Visa:
      <select id="metricSelect">
        <option value="reps">Reps</option>
        <option value="weight">Vikt (kg)</option>
      </select>
    </label>
  </div>

  <div class="card">
    <h2>Utveckling √∂ver tid</h2>
    <canvas id="chart"></canvas>
  </div>

  <div class="card">
    <h2>Alla pass</h2>
    <div id="tableWrap">Laddar...</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const STORAGE_KEY='trainingLogsV1';
async function loadLogs(){
  try{
    const res=await fetch('data/traningslogg.json');
    if(res.ok) return await res.json();
  }catch(e){}
  return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
}
let chart;
function renderChart(data,metric,exName){
  const ctx=document.getElementById('chart').getContext('2d');
  if(chart) chart.destroy();
  const setsCount=Math.max(...data.map(e=>e.sets.length));
  const datasets=[];
  const colors=['#22d3ee','#f87171','#34d399','#fbbf24','#a78bfa','#fb7185'];
  for(let i=0;i<setsCount;i++){
    const points=data.map(d=>({x:d.date,y:d.sets[i]?d.sets[i][metric]:null}));
    datasets.push({label:`Set ${i+1}`,data:points,borderColor:colors[i%colors.length],backgroundColor:colors[i%colors.length],tension:.2});
  }
  chart=new Chart(ctx,{type:'line',data:{datasets},options:{
    responsive:true,parsing:false,
    scales:{x:{type:'time',time:{unit:'day'},title:{display:true,text:'Datum'}},
            y:{title:{display:true,text:metric==='reps'?'Reps':'Vikt (kg)'}}},
    plugins:{title:{display:true,text:exName}}
  }});
}
function renderTable(data,metric){
  if(!data.length){document.getElementById('tableWrap').textContent='Ingen data.';return;}
  let html='<table><thead><tr><th>Datum</th><th>Set</th><th>Reps</th><th>Vikt</th></tr></thead><tbody>';
  data.forEach(d=>{
    d.sets.forEach((s,i)=>{
      html+=`<tr><td>${d.date}</td><td>${i+1}</td><td>${s.reps}</td><td>${s.weight??''}</td></tr>`;
    });
  });
  html+='</tbody></table>';
  document.getElementById('tableWrap').innerHTML=html;
}
async function init(){
  const logs=await loadLogs();
  const exMap=new Map();
  logs.forEach(l=>l.entries.forEach(e=>{ if(!exMap.has(e.exercise)) exMap.set(e.exercise,e.id); }));
  const sel=document.getElementById('exerciseSelect');
  sel.innerHTML=[...exMap.keys()].map(x=>`<option value="${x}">${x}</option>`).join('');
  function update(){
    const ex=sel.value; const metric=document.getElementById('metricSelect').value;
    const exLogs=[];
    logs.forEach(l=>{l.entries.forEach(e=>{if(e.exercise===ex)exLogs.push({date:l.date,sets:e.sets});});});
    exLogs.sort((a,b)=>a.date.localeCompare(b.date));
    renderChart(exLogs,metric,ex);
    renderTable(exLogs,metric);
  }
  sel.onchange=update;
  document.getElementById('metricSelect').onchange=update;
  if(sel.value) update();
}
init();
</script>
</body>
</html>
