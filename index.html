<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Träningslogg – 3-dagarsprogram</title>
  <style>
    :root { --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --txt:#e5e7eb; --accent:#22d3ee; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:linear-gradient(180deg,#0b1022,#0f172a 30%,#0b1022);color:var(--txt)}
    .wrap{max-width:960px;margin:24px auto;padding:16px}
    .card{background:rgba(255,255,255,.04);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{font-size:clamp(22px,3.6vw,34px);margin:0 0 12px;letter-spacing:.3px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .day-btn{flex:1 1 120px;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px 16px;text-align:center;cursor:pointer;user-select:none;background:#0b1224;transition:.15s;}
    .day-btn:hover{transform:translateY(-1px);border-color:var(--accent)}
    .day-btn.active{outline:2px solid var(--accent);background:#0b1a2c}
    .bar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin:14px 0 10px}
    input, button, select, textarea{font:inherit}
    input[type="number"], input[type="date"], select{background:#0b1224;border:1px solid rgba(255,255,255,.12);border-radius:12px;color:var(--txt);padding:10px 12px}
    button{background:var(--accent);color:#001018;border:0;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;color:var(--txt);border:1px solid rgba(255,255,255,.18)}
    .exercise{border-top:1px dashed rgba(255,255,255,.12);padding:14px 0}
    .exercise h3{margin:0 0 6px;font-size:18px}
    .note{font-size:13px;color:var(--muted)}
    .sets{display:grid;grid-template-columns:90px 1fr 1fr 100px;gap:8px;align-items:center}
    .sets label{font-size:12px;color:var(--muted)}
    .set-row{display:contents}
    .pill{display:inline-block;border:1px solid rgba(255,255,255,.18);border-radius:999px;padding:4px 8px;font-size:12px;color:var(--muted)}
    .footer{display:flex;gap:10px;justify-content:flex-end;padding:16px 0}
    details{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px 12px}
    summary{cursor:pointer}
    .hint{font-size:12px;color:#9ae6ff}
    .empty{color:var(--muted);font-style:italic}
    @media (max-width:680px){ .sets{grid-template-columns:70px 1fr 1fr 92px} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" style="padding:18px 18px 8px">
      <h1>Träningslogg <span class="muted">– 3 dagar</span></h1>
      <p class="muted">Välj dag, logga set/reps/vikt. Allt sparas lokalt i din webbläsare (localStorage).
      </p>

      <div class="row" id="dayButtons" style="margin:14px 0 10px"></div>

      <div class="bar">
        <div class="row" style="align-items:center">
          <label for="date" class="muted">Datum</label>
          <input id="date" type="date"/>
          <span id="selectedDayLabel" class="pill">Ingen dag vald</span>
        </div>
        <div class="row">
          <button id="saveBtn">Spara pass</button>
          <button id="exportBtn" class="ghost" title="Ladda ned JSON med alla pass">Exportera data</button>
          <button id="clearBtn" class="ghost" title="Rensa allt sparat">Rensa data</button>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px;padding:14px 18px" id="exercisesPanel">
      <p class="empty">Välj en dag ovan för att se dina övningar.</p>
    </div>

    <div class="card" style="margin-top:16px;padding:14px 18px" id="historyPanel">
      <h2 style="margin:6px 0 8px;font-size:18px">Senaste historik</h2>
      <div id="historyBody" class="muted">Inget sparat ännu.</div>
    </div>
  </div>

<script>
// ===== Program & regler
/** Progressionsregler (enkelt, kan göras smartare senare):
 *  type: 'weekly_weight'  -> föreslå +increment kg jämfört med senaste vikten
 *  type: 'weekly_rep'     -> föreslå +1 rep jämfört med senaste bästa
 *  range: [min,max]       -> riktlinje för repetitionsintervall
 *  bw: true               -> kroppsövning (viktfält döljs som standard)
 */
const PROGRAM = {
  1: [
    { id:'deadlift', name:'Marklyft', range:[5,8], progression:{type:'weekly_weight', increment:2.5} },
    { id:'ohp', name:'Press över huvudet', range:[8,10], progression:{type:'weekly_weight', increment:1} },
    { id:'pullups', name:'Pullups', range:[5,10], progression:{type:'weekly_rep'}, bw:true,
      note:'Öka 1 rep/vecka. Ta bort band när du når 10 reps.' },
    { id:'tri-bi', name:'Triceps/Biceps (varannan övning)', range:[10,15], progression:{type:'weekly_rep'},
      note:'En extra rep/vecka. Öka vikt när du klarar 15 reps.' },
  ],
  2: [
    { id:'bench', name:'Bänkpress', range:[5,8], progression:{type:'weekly_weight', increment:2.5} },
    { id:'row', name:'Stångrodd', range:[10,10], progression:{type:'weekly_weight', increment:2.5} },
    { id:'lunge-db', name:'Utfall med hantlar (per ben)', range:[10,15], progression:{type:'weekly_weight', increment:1.25},
      note:'Öka i vikt när du är uppe på 15 reps.' },
    { id:'lat-raise', name:'Sidolyft med hantlar', range:[10,15], progression:{type:'weekly_weight', increment:1},
      note:'Samma princip som ovan.' },
  ],
  3: [
    { id:'squat', name:'Knäböj', range:[5,8], progression:{type:'weekly_weight', increment:2.5} },
    { id:'pushups', name:'Armhävningar', range:[8,999], progression:{type:'weekly_rep'}, bw:true,
      note:'Öka 1 rep/vecka.' },
    { id:'ringrow', name:'Ringrodd', range:[8,15], progression:{type:'weekly_rep'}, bw:true,
      note:'Öka 1 rep/vecka. Luta dig mer bakåt när du klarar 15.' },
    { id:'bi-tri', name:'Biceps/Triceps (varannan övning)', range:[10,15], progression:{type:'weekly_rep'},
      note:'Samma som dag 1.' },
  ]
};

// ===== Lagring
const STORAGE_KEY = 'trainingLogsV1';
const readLogs = () => JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
const writeLogs = logs => localStorage.setItem(STORAGE_KEY, JSON.stringify(logs));

// ===== Hjälpfunktioner
const fmtRange = r => r[0]===r[1] ? `${r[0]} reps` : `${r[0]}–${r[1]} reps`;
const todayISO = () => new Date().toISOString().slice(0,10);
const h = (tag, attrs={}, ...children) => {
  const el = document.createElement(tag);
  for (const [k,v] of Object.entries(attrs)) {
    if (k==='class') el.className = v; else if (k==='html') el.innerHTML = v; else if (k.startsWith('on')) el.addEventListener(k.slice(2), v); else el.setAttribute(k,v);
  }
  for (const ch of children) el.append(ch);
  return el;
};

// ===== UI: dagar
const dayButtons = document.getElementById('dayButtons');
const selectedDayLabel = document.getElementById('selectedDayLabel');
let selectedDay = null;

for (const day of [1,2,3]){
  const b = h('div',{class:'day-btn', id:`btn-day-${day}`, onclick:()=>selectDay(day)}, `Dag ${day}`);
  dayButtons.append(b);
}

function selectDay(day){
  selectedDay = day;
  document.querySelectorAll('.day-btn').forEach(el=>el.classList.remove('active'));
  document.getElementById(`btn-day-${day}`).classList.add('active');
  selectedDayLabel.textContent = `Dag ${day}`;
  renderExercises();
}

// ===== UI: övningar
const exercisesPanel = document.getElementById('exercisesPanel');

function renderExercises(){
  exercisesPanel.innerHTML = '';
  if(!selectedDay){
    exercisesPanel.append(h('p',{class:'empty'},'Välj en dag ovan.'));
    return;
  }
  const list = PROGRAM[selectedDay];
  list.forEach(ex => {
    const container = h('div',{class:'exercise'});
    const title = h('h3',{}, ex.name);
    const range = h('span',{class:'pill'}, fmtRange(ex.range));
    const hint = h('div',{class:'hint', id:`hint-${ex.id}`});

    // Set-lista
    const sets = h('div',{class:'sets'});
    sets.append(h('label',{},'Set#'), h('label',{},'Reps'), h('label',{}, ex.bw ? 'Vikt (valfritt)' : 'Vikt (kg)'), h('div'));

    const addSetRow = (i=1, reps='', weight='')=>{
      const row = h('div',{class:'set-row'});
      row.append(
        h('div',{class:'muted'}, `#${i}`),
        h('input',{type:'number', min:0, step:1, placeholder:'reps', value:reps}),
        h('input',{type:'number', min:0, step: ex.progression?.increment || 0.5, placeholder: ex.bw ? 'valfritt' : 'kg', value:weight, style: ex.bw ? 'opacity:.85' : ''}),
        h('button',{class:'ghost', onclick:()=>{ row.remove(); renumber(sets); }}, 'Ta bort')
      );
      sets.append(row);
    };

    function renumber(grid){
      let i=1; [...grid.querySelectorAll('.set-row')].forEach(r=>{ r.firstChild.textContent = `#${i++}`; });
    }

    const addBtn = h('button',{class:'ghost', onclick:()=>{ addSetRow(sets.querySelectorAll('.set-row').length+1); }}, '+ Lägg till set');

    // Förifyll 3 set
    for(let i=1;i<=3;i++) addSetRow(i);

    const note = h('div',{class:'note'}, ex.note || ruleText(ex));

    container.append(
      h('div',{class:'row', style:'align-items:baseline;justify-content:space-between'},
        h('div',{}, title, ' ', range),
        addBtn
      ),
      sets,
      note,
      hint
    );
    exercisesPanel.append(container);

    // visa förslag baserat på senaste
    updateHint(ex, hint);
  });
}

function ruleText(ex){
  if(!ex.progression) return '';
  const p = ex.progression;
  if(p.type==='weekly_weight') return `Riktlinje: öka ~${p.increment} kg/vecka när tekniken känns bra.`;
  if(p.type==='weekly_rep') return `Riktlinje: öka ~1 rep/vecka inom intervallet.`;
  return '';
}

// ===== Historik & förslag
const historyBody = document.getElementById('historyBody');

function updateHistory(){
  const logs = readLogs();
  if(!logs.length){ historyBody.textContent = 'Inget sparat ännu.'; return; }
  // Visa senaste 6 passen
  const recent = logs.slice(-6).reverse();
  historyBody.innerHTML = '';
  recent.forEach(l => {
    const dd = new Date(l.date).toLocaleDateString('sv-SE');
    const box = h('details',{}, h('summary',{}, `${dd} – Dag ${l.day}`));
    const ul = h('ul',{});
    l.entries.forEach(e => {
      const best = e.sets.map(s=> (s.weight||0)).reduce((a,b)=>Math.max(a,b),0);
      const txt = `${e.exercise}: ${e.sets.map(s=>`${s.reps}x${s.weight||0}kg`).join(', ')}`;
      ul.append(h('li',{}, txt));
    });
    box.append(ul);
    historyBody.append(box);
  });
}

function lastFor(exId){
  const logs = readLogs().slice().reverse();
  for(const l of logs){
    const e = l.entries.find(x=>x.id===exId);
    if(e) return e; // returnerar senaste passet där övningen fanns
  }
  return null;
}

function updateHint(ex, hintEl){
  const last = lastFor(ex.id);
  if(!last){ hintEl.textContent = 'Tips: logga första passet, så får du förslag nästa gång.'; return; }
  const p = ex.progression || {};
  let msg = 'Senast: ' + last.sets.map(s=>`${s.reps}x${s.weight||0}kg`).join(', ');
  if(p.type==='weekly_weight'){
    // föreslå ny vikt = högsta från senaste + increment
    const maxW = Math.max(...last.sets.map(s=>Number(s.weight)||0));
    msg += ` → Förslag: sikta på ~${(maxW + (p.increment||0)).toFixed(1)} kg (om det känns bra).`;
  } else if (p.type==='weekly_rep'){
    const maxR = Math.max(...last.sets.map(s=>Number(s.reps)||0));
    msg += ` → Förslag: +1 rep (t.ex. ${maxR+1} på bästa set).`;
  }
  hintEl.textContent = msg;
}

// ===== Spara / Export / Rensa
const dateInput = document.getElementById('date');
const saveBtn = document.getElementById('saveBtn');
const exportBtn = document.getElementById('exportBtn');
const clearBtn = document.getElementById('clearBtn');

dateInput.value = todayISO();

saveBtn.addEventListener('click', ()=>{
  if(!selectedDay){ alert('Välj dag först.'); return; }
  const list = PROGRAM[selectedDay];
  const entries = [];
  const exEls = [...exercisesPanel.querySelectorAll('.exercise')];
  exEls.forEach((wrap, idx)=>{
    const ex = list[idx];
    const rows = [...wrap.querySelectorAll('.set-row')];
    const sets = rows.map(r=>{
      const [lbl, repsEl, wEl] = r.children; // lbl är #
      return { reps: Number(repsEl.value||0), weight: Number(wEl.value||0) || (ex.bw? null : 0) };
    }).filter(s=> (s.reps||0) > 0 );
    if(sets.length) entries.push({ id: ex.id, exercise: ex.name, sets });
  });
  if(!entries.length){ alert('Fyll i minst ett set.'); return; }

  const log = { date: dateInput.value, day: selectedDay, entries };
  const logs = readLogs();
  logs.push(log); writeLogs(logs);
  updateHistory();
  // uppdatera hintar baserat på sparat
  PROGRAM[selectedDay].forEach(ex=>{
    const el = document.getElementById(`hint-${ex.id}`);
    if(el) updateHint(ex, el);
  })
  alert('Sparat!');
});

exportBtn.addEventListener('click', ()=>{
  const data = JSON.stringify(readLogs(), null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'traningslogg.json';
  a.click();
  URL.revokeObjectURL(a.href);
});

clearBtn.addEventListener('click', ()=>{
  if(confirm('Detta rensar all lokal data i den här webbläsaren. Fortsätta?')){
    localStorage.removeItem(STORAGE_KEY);
    updateHistory();
    if(selectedDay) renderExercises();
  }
});

// Init
updateHistory();
// Förvalt: välj Dag 1
selectDay(1);
</script>
</body>
</html>
